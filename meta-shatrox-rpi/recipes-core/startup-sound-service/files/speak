#!/bin/bash
################################################################################
# speak - Simple espeak wrapper for Raspberry Pi USB Audio
# Usage: speak "Your text here"
################################################################################

# Check if text provided
if [ $# -eq 0 ]; then
    echo "Usage: speak \"Your text here\""
    echo "Example: speak \"Hello world\""
    exit 1
fi

# Combine all arguments as the message
MESSAGE="$*"

# Detect audio device
AUDIO_DEVICE=$(/usr/bin/detect-audio.sh)

# Speak the message
# -s 150: speed (words per minute)
# -v en-us+m1: US English male voice
# Output to stdout, pipe to aplay with automatic format conversion
espeak --stdout -s 140 -v en-us+m3 "${MESSAGE}" 2>/dev/null | \
    aplay -q -D"${AUDIO_DEVICE}" 2>/dev/null

exit $?
